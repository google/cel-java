Test case: SIZE_1
Source: size([1,2]) + size([1,2]) + 1 == 5
=====>
CALL [1] {
  function: _==_
  args: {
    CALL [2] {
      function: _+_
      args: {
        COMPREHENSION [3] {
          iter_var: #unused
          iter_range: {
            LIST [4] {
              elements: {
              }
            }
          }
          accu_var: @r0
          accu_init: {
            CALL [5] {
              function: size
              args: {
                LIST [6] {
                  elements: {
                    CONSTANT [7] { value: 1 }
                    CONSTANT [8] { value: 2 }
                  }
                }
              }
            }
          }
          loop_condition: {
            CONSTANT [9] { value: false }
          }
          loop_step: {
            IDENT [10] {
              name: @r0
            }
          }
          result: {
            CALL [11] {
              function: _+_
              args: {
                IDENT [12] {
                  name: @r0
                }
                IDENT [13] {
                  name: @r0
                }
              }
            }
          }
        }
        CONSTANT [14] { value: 1 }
      }
    }
    CONSTANT [15] { value: 5 }
  }
}
Test case: SIZE_2
Source: 2 + size([1,2]) + size([1,2]) + 1 == 7
=====>
CALL [1] {
  function: _==_
  args: {
    CALL [2] {
      function: _+_
      args: {
        COMPREHENSION [3] {
          iter_var: #unused
          iter_range: {
            LIST [4] {
              elements: {
              }
            }
          }
          accu_var: @r0
          accu_init: {
            CALL [5] {
              function: size
              args: {
                LIST [6] {
                  elements: {
                    CONSTANT [7] { value: 1 }
                    CONSTANT [8] { value: 2 }
                  }
                }
              }
            }
          }
          loop_condition: {
            CONSTANT [9] { value: false }
          }
          loop_step: {
            IDENT [10] {
              name: @r0
            }
          }
          result: {
            CALL [11] {
              function: _+_
              args: {
                CALL [12] {
                  function: _+_
                  args: {
                    CONSTANT [13] { value: 2 }
                    IDENT [14] {
                      name: @r0
                    }
                  }
                }
                IDENT [15] {
                  name: @r0
                }
              }
            }
          }
        }
        CONSTANT [16] { value: 1 }
      }
    }
    CONSTANT [17] { value: 7 }
  }
}
Test case: SIZE_3
Source: size([0]) + size([0]) + size([1,2]) + size([1,2]) == 6
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        CALL [4] {
          function: size
          args: {
            LIST [5] {
              elements: {
                CONSTANT [6] { value: 1 }
                CONSTANT [7] { value: 2 }
              }
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [8] { value: false }
      }
      loop_step: {
        IDENT [9] {
          name: @r1
        }
      }
      result: {
        CALL [10] {
          function: _+_
          args: {
            CALL [11] {
              function: _+_
              args: {
                COMPREHENSION [12] {
                  iter_var: #unused
                  iter_range: {
                    LIST [13] {
                      elements: {
                      }
                    }
                  }
                  accu_var: @r0
                  accu_init: {
                    CALL [14] {
                      function: size
                      args: {
                        LIST [15] {
                          elements: {
                            CONSTANT [16] { value: 0 }
                          }
                        }
                      }
                    }
                  }
                  loop_condition: {
                    CONSTANT [17] { value: false }
                  }
                  loop_step: {
                    IDENT [18] {
                      name: @r0
                    }
                  }
                  result: {
                    CALL [19] {
                      function: _+_
                      args: {
                        IDENT [20] {
                          name: @r0
                        }
                        IDENT [21] {
                          name: @r0
                        }
                      }
                    }
                  }
                }
                IDENT [22] {
                  name: @r1
                }
              }
            }
            IDENT [23] {
              name: @r1
            }
          }
        }
      }
    }
    CONSTANT [24] { value: 6 }
  }
}
Test case: SIZE_4
Source: 5 + size([0]) + size([0]) + size([1,2]) + size([1,2]) + size([1,2,3]) + size([1,2,3]) == 17
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r2
      accu_init: {
        CALL [4] {
          function: size
          args: {
            LIST [5] {
              elements: {
                CONSTANT [6] { value: 1 }
                CONSTANT [7] { value: 2 }
                CONSTANT [8] { value: 3 }
              }
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [9] { value: false }
      }
      loop_step: {
        IDENT [10] {
          name: @r2
        }
      }
      result: {
        CALL [11] {
          function: _+_
          args: {
            CALL [12] {
              function: _+_
              args: {
                COMPREHENSION [13] {
                  iter_var: #unused
                  iter_range: {
                    LIST [14] {
                      elements: {
                      }
                    }
                  }
                  accu_var: @r1
                  accu_init: {
                    CALL [15] {
                      function: size
                      args: {
                        LIST [16] {
                          elements: {
                            CONSTANT [17] { value: 1 }
                            CONSTANT [18] { value: 2 }
                          }
                        }
                      }
                    }
                  }
                  loop_condition: {
                    CONSTANT [19] { value: false }
                  }
                  loop_step: {
                    IDENT [20] {
                      name: @r1
                    }
                  }
                  result: {
                    CALL [21] {
                      function: _+_
                      args: {
                        CALL [22] {
                          function: _+_
                          args: {
                            COMPREHENSION [23] {
                              iter_var: #unused
                              iter_range: {
                                LIST [24] {
                                  elements: {
                                  }
                                }
                              }
                              accu_var: @r0
                              accu_init: {
                                CALL [25] {
                                  function: size
                                  args: {
                                    LIST [26] {
                                      elements: {
                                        CONSTANT [27] { value: 0 }
                                      }
                                    }
                                  }
                                }
                              }
                              loop_condition: {
                                CONSTANT [28] { value: false }
                              }
                              loop_step: {
                                IDENT [29] {
                                  name: @r0
                                }
                              }
                              result: {
                                CALL [30] {
                                  function: _+_
                                  args: {
                                    CALL [31] {
                                      function: _+_
                                      args: {
                                        CONSTANT [32] { value: 5 }
                                        IDENT [33] {
                                          name: @r0
                                        }
                                      }
                                    }
                                    IDENT [34] {
                                      name: @r0
                                    }
                                  }
                                }
                              }
                            }
                            IDENT [35] {
                              name: @r1
                            }
                          }
                        }
                        IDENT [36] {
                          name: @r1
                        }
                      }
                    }
                  }
                }
                IDENT [37] {
                  name: @r2
                }
              }
            }
            IDENT [38] {
              name: @r2
            }
          }
        }
      }
    }
    CONSTANT [39] { value: 17 }
  }
}
Test case: TIMESTAMP
Source: timestamp(int(timestamp(1000000000))).getFullYear() + timestamp(int(timestamp(75))).getFullYear() +  timestamp(int(timestamp(50))).getFullYear() +  timestamp(int(timestamp(1000000000))).getFullYear() +  timestamp(int(timestamp(50))).getSeconds() +  timestamp(int(timestamp(200))).getFullYear() +  timestamp(int(timestamp(200))).getFullYear() +  timestamp(int(timestamp(75))).getMinutes() +  timestamp(int(timestamp(1000000000))).getFullYear() == 13934
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        CALL [4] {
          function: getFullYear
          target: {
            CALL [5] {
              function: timestamp
              args: {
                CALL [6] {
                  function: int
                  args: {
                    CALL [7] {
                      function: timestamp
                      args: {
                        CONSTANT [8] { value: 1000000000 }
                      }
                    }
                  }
                }
              }
            }
          }
          args: {
          }
        }
      }
      loop_condition: {
        CONSTANT [9] { value: false }
      }
      loop_step: {
        IDENT [10] {
          name: @r0
        }
      }
      result: {
        CALL [11] {
          function: _+_
          args: {
            COMPREHENSION [12] {
              iter_var: #unused
              iter_range: {
                LIST [13] {
                  elements: {
                  }
                }
              }
              accu_var: @r3
              accu_init: {
                CALL [14] {
                  function: timestamp
                  args: {
                    CALL [15] {
                      function: int
                      args: {
                        CALL [16] {
                          function: timestamp
                          args: {
                            CONSTANT [17] { value: 75 }
                          }
                        }
                      }
                    }
                  }
                }
              }
              loop_condition: {
                CONSTANT [18] { value: false }
              }
              loop_step: {
                IDENT [19] {
                  name: @r3
                }
              }
              result: {
                CALL [20] {
                  function: _+_
                  args: {
                    COMPREHENSION [21] {
                      iter_var: #unused
                      iter_range: {
                        LIST [22] {
                          elements: {
                          }
                        }
                      }
                      accu_var: @r2
                      accu_init: {
                        CALL [23] {
                          function: getFullYear
                          target: {
                            CALL [24] {
                              function: timestamp
                              args: {
                                CALL [25] {
                                  function: int
                                  args: {
                                    CALL [26] {
                                      function: timestamp
                                      args: {
                                        CONSTANT [27] { value: 200 }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                          args: {
                          }
                        }
                      }
                      loop_condition: {
                        CONSTANT [28] { value: false }
                      }
                      loop_step: {
                        IDENT [29] {
                          name: @r2
                        }
                      }
                      result: {
                        CALL [30] {
                          function: _+_
                          args: {
                            CALL [31] {
                              function: _+_
                              args: {
                                COMPREHENSION [32] {
                                  iter_var: #unused
                                  iter_range: {
                                    LIST [33] {
                                      elements: {
                                      }
                                    }
                                  }
                                  accu_var: @r1
                                  accu_init: {
                                    CALL [34] {
                                      function: timestamp
                                      args: {
                                        CALL [35] {
                                          function: int
                                          args: {
                                            CALL [36] {
                                              function: timestamp
                                              args: {
                                                CONSTANT [37] { value: 50 }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                  loop_condition: {
                                    CONSTANT [38] { value: false }
                                  }
                                  loop_step: {
                                    IDENT [39] {
                                      name: @r1
                                    }
                                  }
                                  result: {
                                    CALL [40] {
                                      function: _+_
                                      args: {
                                        CALL [41] {
                                          function: _+_
                                          args: {
                                            CALL [42] {
                                              function: _+_
                                              args: {
                                                CALL [43] {
                                                  function: _+_
                                                  args: {
                                                    IDENT [44] {
                                                      name: @r0
                                                    }
                                                    CALL [45] {
                                                      function: getFullYear
                                                      target: {
                                                        IDENT [46] {
                                                          name: @r3
                                                        }
                                                      }
                                                      args: {
                                                      }
                                                    }
                                                  }
                                                }
                                                CALL [47] {
                                                  function: getFullYear
                                                  target: {
                                                    IDENT [48] {
                                                      name: @r1
                                                    }
                                                  }
                                                  args: {
                                                  }
                                                }
                                              }
                                            }
                                            IDENT [49] {
                                              name: @r0
                                            }
                                          }
                                        }
                                        CALL [50] {
                                          function: getSeconds
                                          target: {
                                            IDENT [51] {
                                              name: @r1
                                            }
                                          }
                                          args: {
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                                IDENT [52] {
                                  name: @r2
                                }
                              }
                            }
                            IDENT [53] {
                              name: @r2
                            }
                          }
                        }
                      }
                    }
                    CALL [54] {
                      function: getMinutes
                      target: {
                        IDENT [55] {
                          name: @r3
                        }
                      }
                      args: {
                      }
                    }
                  }
                }
              }
            }
            IDENT [56] {
              name: @r0
            }
          }
        }
      }
    }
    CONSTANT [57] { value: 13934 }
  }
}
Test case: MAP_INDEX
Source: {"a": 2}["a"] + {"a": 2}["a"] * {"a": 2}["a"] == 6
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        CALL [4] {
          function: _[_]
          args: {
            MAP [5] {
              MAP_ENTRY [6] {
                key: {
                  CONSTANT [7] { value: "a" }
                }
                value: {
                  CONSTANT [8] { value: 2 }
                }
              }
            }
            CONSTANT [9] { value: "a" }
          }
        }
      }
      loop_condition: {
        CONSTANT [10] { value: false }
      }
      loop_step: {
        IDENT [11] {
          name: @r0
        }
      }
      result: {
        CALL [12] {
          function: _+_
          args: {
            IDENT [13] {
              name: @r0
            }
            CALL [14] {
              function: _*_
              args: {
                IDENT [15] {
                  name: @r0
                }
                IDENT [16] {
                  name: @r0
                }
              }
            }
          }
        }
      }
    }
    CONSTANT [17] { value: 6 }
  }
}
Test case: NESTED_MAP_CONSTRUCTION
Source: {'a': {'b': 1}, 'c': {'b': 1}, 'd': {'e': {'b': 1}}, 'e': {'e': {'b': 1}}}
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    MAP [3] {
      MAP_ENTRY [4] {
        key: {
          CONSTANT [5] { value: "b" }
        }
        value: {
          CONSTANT [6] { value: 1 }
        }
      }
    }
  }
  loop_condition: {
    CONSTANT [7] { value: false }
  }
  loop_step: {
    IDENT [8] {
      name: @r0
    }
  }
  result: {
    COMPREHENSION [9] {
      iter_var: #unused
      iter_range: {
        LIST [10] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        MAP [11] {
          MAP_ENTRY [12] {
            key: {
              CONSTANT [13] { value: "e" }
            }
            value: {
              IDENT [14] {
                name: @r0
              }
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [15] { value: false }
      }
      loop_step: {
        IDENT [16] {
          name: @r1
        }
      }
      result: {
        MAP [17] {
          MAP_ENTRY [18] {
            key: {
              CONSTANT [19] { value: "a" }
            }
            value: {
              IDENT [20] {
                name: @r0
              }
            }
          }
          MAP_ENTRY [21] {
            key: {
              CONSTANT [22] { value: "c" }
            }
            value: {
              IDENT [23] {
                name: @r0
              }
            }
          }
          MAP_ENTRY [24] {
            key: {
              CONSTANT [25] { value: "d" }
            }
            value: {
              IDENT [26] {
                name: @r1
              }
            }
          }
          MAP_ENTRY [27] {
            key: {
              CONSTANT [28] { value: "e" }
            }
            value: {
              IDENT [29] {
                name: @r1
              }
            }
          }
        }
      }
    }
  }
}
Test case: NESTED_LIST_CONSTRUCTION
Source: [1, [1,2,3,4], 2, [1,2,3,4], 5, [1,2,3,4], 7, [[1,2], [1,2,3,4]], [1,2]]
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    LIST [3] {
      elements: {
        CONSTANT [4] { value: 1 }
        CONSTANT [5] { value: 2 }
        CONSTANT [6] { value: 3 }
        CONSTANT [7] { value: 4 }
      }
    }
  }
  loop_condition: {
    CONSTANT [8] { value: false }
  }
  loop_step: {
    IDENT [9] {
      name: @r0
    }
  }
  result: {
    COMPREHENSION [10] {
      iter_var: #unused
      iter_range: {
        LIST [11] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        LIST [12] {
          elements: {
            CONSTANT [13] { value: 1 }
            CONSTANT [14] { value: 2 }
          }
        }
      }
      loop_condition: {
        CONSTANT [15] { value: false }
      }
      loop_step: {
        IDENT [16] {
          name: @r1
        }
      }
      result: {
        LIST [17] {
          elements: {
            CONSTANT [18] { value: 1 }
            IDENT [19] {
              name: @r0
            }
            CONSTANT [20] { value: 2 }
            IDENT [21] {
              name: @r0
            }
            CONSTANT [22] { value: 5 }
            IDENT [23] {
              name: @r0
            }
            CONSTANT [24] { value: 7 }
            LIST [25] {
              elements: {
                IDENT [26] {
                  name: @r1
                }
                IDENT [27] {
                  name: @r0
                }
              }
            }
            IDENT [28] {
              name: @r1
            }
          }
        }
      }
    }
  }
}
Test case: SELECT
Source: msg.single_int64 + msg.single_int64 == 6
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          IDENT [5] {
            name: msg
          }.single_int64
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r0
        }
      }
      result: {
        CALL [8] {
          function: _+_
          args: {
            IDENT [9] {
              name: @r0
            }
            IDENT [10] {
              name: @r0
            }
          }
        }
      }
    }
    CONSTANT [11] { value: 6 }
  }
}
Test case: SELECT_NESTED_1
Source: msg.oneof_type.payload.single_int64 + msg.oneof_type.payload.single_int32 + msg.oneof_type.payload.single_int64 + msg.single_int64 + msg.oneof_type.payload.oneof_type.payload.single_int64 == 31
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          SELECT [5] {
            IDENT [6] {
              name: msg
            }.oneof_type
          }.payload
        }
      }
      loop_condition: {
        CONSTANT [7] { value: false }
      }
      loop_step: {
        IDENT [8] {
          name: @r0
        }
      }
      result: {
        CALL [9] {
          function: _+_
          args: {
            CALL [10] {
              function: _+_
              args: {
                COMPREHENSION [11] {
                  iter_var: #unused
                  iter_range: {
                    LIST [12] {
                      elements: {
                      }
                    }
                  }
                  accu_var: @r1
                  accu_init: {
                    SELECT [13] {
                      IDENT [14] {
                        name: @r0
                      }.single_int64
                    }
                  }
                  loop_condition: {
                    CONSTANT [15] { value: false }
                  }
                  loop_step: {
                    IDENT [16] {
                      name: @r1
                    }
                  }
                  result: {
                    CALL [17] {
                      function: _+_
                      args: {
                        CALL [18] {
                          function: _+_
                          args: {
                            IDENT [19] {
                              name: @r1
                            }
                            SELECT [20] {
                              IDENT [21] {
                                name: @r0
                              }.single_int32
                            }
                          }
                        }
                        IDENT [22] {
                          name: @r1
                        }
                      }
                    }
                  }
                }
                SELECT [23] {
                  IDENT [24] {
                    name: msg
                  }.single_int64
                }
              }
            }
            SELECT [25] {
              SELECT [26] {
                SELECT [27] {
                  IDENT [28] {
                    name: @r0
                  }.oneof_type
                }.payload
              }.single_int64
            }
          }
        }
      }
    }
    CONSTANT [29] { value: 31 }
  }
}
Test case: SELECT_NESTED_2
Source: true || msg.oneof_type.payload.oneof_type.payload.oneof_type.payload.oneof_type.payload.single_bool || msg.oneof_type.payload.oneof_type.payload.oneof_type.child.child.payload.single_bool
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    SELECT [3] {
      SELECT [4] {
        SELECT [5] {
          SELECT [6] {
            SELECT [7] {
              IDENT [8] {
                name: msg
              }.oneof_type
            }.payload
          }.oneof_type
        }.payload
      }.oneof_type
    }
  }
  loop_condition: {
    CONSTANT [9] { value: false }
  }
  loop_step: {
    IDENT [10] {
      name: @r0
    }
  }
  result: {
    CALL [11] {
      function: _||_
      args: {
        CALL [12] {
          function: _||_
          args: {
            CONSTANT [13] { value: true }
            SELECT [14] {
              SELECT [15] {
                SELECT [16] {
                  SELECT [17] {
                    IDENT [18] {
                      name: @r0
                    }.payload
                  }.oneof_type
                }.payload
              }.single_bool
            }
          }
        }
        SELECT [19] {
          SELECT [20] {
            SELECT [21] {
              SELECT [22] {
                IDENT [23] {
                  name: @r0
                }.child
              }.child
            }.payload
          }.single_bool
        }
      }
    }
  }
}
Test case: SELECT_NESTED_MESSAGE_MAP_INDEX_1
Source: msg.oneof_type.payload.map_int32_int64[1] + msg.oneof_type.payload.map_int32_int64[1] + msg.oneof_type.payload.map_int32_int64[1] == 15
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        CALL [4] {
          function: _[_]
          args: {
            SELECT [5] {
              SELECT [6] {
                SELECT [7] {
                  IDENT [8] {
                    name: msg
                  }.oneof_type
                }.payload
              }.map_int32_int64
            }
            CONSTANT [9] { value: 1 }
          }
        }
      }
      loop_condition: {
        CONSTANT [10] { value: false }
      }
      loop_step: {
        IDENT [11] {
          name: @r0
        }
      }
      result: {
        CALL [12] {
          function: _+_
          args: {
            CALL [13] {
              function: _+_
              args: {
                IDENT [14] {
                  name: @r0
                }
                IDENT [15] {
                  name: @r0
                }
              }
            }
            IDENT [16] {
              name: @r0
            }
          }
        }
      }
    }
    CONSTANT [17] { value: 15 }
  }
}
Test case: SELECT_NESTED_MESSAGE_MAP_INDEX_2
Source: msg.oneof_type.payload.map_int32_int64[0] + msg.oneof_type.payload.map_int32_int64[1] + msg.oneof_type.payload.map_int32_int64[2] == 8
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          SELECT [5] {
            SELECT [6] {
              IDENT [7] {
                name: msg
              }.oneof_type
            }.payload
          }.map_int32_int64
        }
      }
      loop_condition: {
        CONSTANT [8] { value: false }
      }
      loop_step: {
        IDENT [9] {
          name: @r0
        }
      }
      result: {
        CALL [10] {
          function: _+_
          args: {
            CALL [11] {
              function: _+_
              args: {
                CALL [12] {
                  function: _[_]
                  args: {
                    IDENT [13] {
                      name: @r0
                    }
                    CONSTANT [14] { value: 0 }
                  }
                }
                CALL [15] {
                  function: _[_]
                  args: {
                    IDENT [16] {
                      name: @r0
                    }
                    CONSTANT [17] { value: 1 }
                  }
                }
              }
            }
            CALL [18] {
              function: _[_]
              args: {
                IDENT [19] {
                  name: @r0
                }
                CONSTANT [20] { value: 2 }
              }
            }
          }
        }
      }
    }
    CONSTANT [21] { value: 8 }
  }
}
Test case: SELECT_NESTED_NO_COMMON_SUBEXPR
Source: msg.oneof_type.payload.oneof_type.payload.oneof_type.payload.oneof_type.payload.single_int64
=====>
SELECT [10] {
  SELECT [9] {
    SELECT [8] {
      SELECT [7] {
        SELECT [6] {
          SELECT [5] {
            SELECT [4] {
              SELECT [3] {
                SELECT [2] {
                  IDENT [1] {
                    name: msg
                  }.oneof_type
                }.payload
              }.oneof_type
            }.payload
          }.oneof_type
        }.payload
      }.oneof_type
    }.payload
  }.single_int64
}
Test case: TERNARY
Source: (msg.single_int64 > 0 ? msg.single_int64 : 0) == 3
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          IDENT [5] {
            name: msg
          }.single_int64
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r0
        }
      }
      result: {
        CALL [8] {
          function: _?_:_
          args: {
            CALL [9] {
              function: _>_
              args: {
                IDENT [10] {
                  name: @r0
                }
                CONSTANT [11] { value: 0 }
              }
            }
            IDENT [12] {
              name: @r0
            }
            CONSTANT [13] { value: 0 }
          }
        }
      }
    }
    CONSTANT [14] { value: 3 }
  }
}
Test case: TERNARY_BIND_RHS_ONLY
Source: false ? false : (msg.single_int64) + ((msg.single_int64 + 1) * 2) == 11
=====>
CALL [1] {
  function: _?_:_
  args: {
    CONSTANT [2] { value: false }
    CONSTANT [3] { value: false }
    CALL [4] {
      function: _==_
      args: {
        COMPREHENSION [5] {
          iter_var: #unused
          iter_range: {
            LIST [6] {
              elements: {
              }
            }
          }
          accu_var: @r0
          accu_init: {
            SELECT [7] {
              IDENT [8] {
                name: msg
              }.single_int64
            }
          }
          loop_condition: {
            CONSTANT [9] { value: false }
          }
          loop_step: {
            IDENT [10] {
              name: @r0
            }
          }
          result: {
            CALL [11] {
              function: _+_
              args: {
                IDENT [12] {
                  name: @r0
                }
                CALL [13] {
                  function: _*_
                  args: {
                    CALL [14] {
                      function: _+_
                      args: {
                        IDENT [15] {
                          name: @r0
                        }
                        CONSTANT [16] { value: 1 }
                      }
                    }
                    CONSTANT [17] { value: 2 }
                  }
                }
              }
            }
          }
        }
        CONSTANT [18] { value: 11 }
      }
    }
  }
}
Test case: NESTED_TERNARY
Source: (msg.single_int64 > 0 ? (msg.single_int32 > 0 ? msg.single_int64 + msg.single_int32 : 0) : 0) == 8
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          IDENT [5] {
            name: msg
          }.single_int64
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r0
        }
      }
      result: {
        CALL [8] {
          function: _?_:_
          args: {
            CALL [9] {
              function: _>_
              args: {
                IDENT [10] {
                  name: @r0
                }
                CONSTANT [11] { value: 0 }
              }
            }
            COMPREHENSION [12] {
              iter_var: #unused
              iter_range: {
                LIST [13] {
                  elements: {
                  }
                }
              }
              accu_var: @r1
              accu_init: {
                SELECT [14] {
                  IDENT [15] {
                    name: msg
                  }.single_int32
                }
              }
              loop_condition: {
                CONSTANT [16] { value: false }
              }
              loop_step: {
                IDENT [17] {
                  name: @r1
                }
              }
              result: {
                CALL [18] {
                  function: _?_:_
                  args: {
                    CALL [19] {
                      function: _>_
                      args: {
                        IDENT [20] {
                          name: @r1
                        }
                        CONSTANT [21] { value: 0 }
                      }
                    }
                    CALL [22] {
                      function: _+_
                      args: {
                        IDENT [23] {
                          name: @r0
                        }
                        IDENT [24] {
                          name: @r1
                        }
                      }
                    }
                    CONSTANT [25] { value: 0 }
                  }
                }
              }
            }
            CONSTANT [26] { value: 0 }
          }
        }
      }
    }
    CONSTANT [27] { value: 8 }
  }
}
Test case: MULTIPLE_MACROS_1
Source: size([[1].exists(i, i > 0)]) + size([[1].exists(j, j > 0)]) + size([[2].exists(k, k > 1)]) + size([[2].exists(l, l > 1)]) == 4
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        LIST [4] {
          elements: {
            CONSTANT [5] { value: 2 }
          }
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r1
        }
      }
      result: {
        CALL [8] {
          function: _+_
          args: {
            CALL [9] {
              function: _+_
              args: {
                COMPREHENSION [10] {
                  iter_var: #unused
                  iter_range: {
                    LIST [11] {
                      elements: {
                      }
                    }
                  }
                  accu_var: @r0
                  accu_init: {
                    LIST [12] {
                      elements: {
                        CONSTANT [13] { value: 1 }
                      }
                    }
                  }
                  loop_condition: {
                    CONSTANT [14] { value: false }
                  }
                  loop_step: {
                    IDENT [15] {
                      name: @r0
                    }
                  }
                  result: {
                    CALL [16] {
                      function: _+_
                      args: {
                        CALL [17] {
                          function: size
                          args: {
                            LIST [18] {
                              elements: {
                                COMPREHENSION [19] {
                                  iter_var: @it:0
                                  iter_range: {
                                    IDENT [20] {
                                      name: @r0
                                    }
                                  }
                                  accu_var: @ac:0
                                  accu_init: {
                                    CONSTANT [21] { value: false }
                                  }
                                  loop_condition: {
                                    CALL [22] {
                                      function: @not_strictly_false
                                      args: {
                                        CALL [23] {
                                          function: !_
                                          args: {
                                            IDENT [24] {
                                              name: @ac:0
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                  loop_step: {
                                    CALL [25] {
                                      function: _||_
                                      args: {
                                        IDENT [26] {
                                          name: @ac:0
                                        }
                                        CALL [27] {
                                          function: _>_
                                          args: {
                                            IDENT [28] {
                                              name: @it:0
                                            }
                                            CONSTANT [29] { value: 0 }
                                          }
                                        }
                                      }
                                    }
                                  }
                                  result: {
                                    IDENT [30] {
                                      name: @ac:0
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                        CALL [31] {
                          function: size
                          args: {
                            LIST [32] {
                              elements: {
                                COMPREHENSION [33] {
                                  iter_var: @it:1
                                  iter_range: {
                                    IDENT [34] {
                                      name: @r0
                                    }
                                  }
                                  accu_var: @ac:1
                                  accu_init: {
                                    CONSTANT [35] { value: false }
                                  }
                                  loop_condition: {
                                    CALL [36] {
                                      function: @not_strictly_false
                                      args: {
                                        CALL [37] {
                                          function: !_
                                          args: {
                                            IDENT [38] {
                                              name: @ac:1
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                  loop_step: {
                                    CALL [39] {
                                      function: _||_
                                      args: {
                                        IDENT [40] {
                                          name: @ac:1
                                        }
                                        CALL [41] {
                                          function: _>_
                                          args: {
                                            IDENT [42] {
                                              name: @it:1
                                            }
                                            CONSTANT [43] { value: 0 }
                                          }
                                        }
                                      }
                                    }
                                  }
                                  result: {
                                    IDENT [44] {
                                      name: @ac:1
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
                CALL [45] {
                  function: size
                  args: {
                    LIST [46] {
                      elements: {
                        COMPREHENSION [47] {
                          iter_var: @it:2
                          iter_range: {
                            IDENT [48] {
                              name: @r1
                            }
                          }
                          accu_var: @ac:2
                          accu_init: {
                            CONSTANT [49] { value: false }
                          }
                          loop_condition: {
                            CALL [50] {
                              function: @not_strictly_false
                              args: {
                                CALL [51] {
                                  function: !_
                                  args: {
                                    IDENT [52] {
                                      name: @ac:2
                                    }
                                  }
                                }
                              }
                            }
                          }
                          loop_step: {
                            CALL [53] {
                              function: _||_
                              args: {
                                IDENT [54] {
                                  name: @ac:2
                                }
                                CALL [55] {
                                  function: _>_
                                  args: {
                                    IDENT [56] {
                                      name: @it:2
                                    }
                                    CONSTANT [57] { value: 1 }
                                  }
                                }
                              }
                            }
                          }
                          result: {
                            IDENT [58] {
                              name: @ac:2
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
            CALL [59] {
              function: size
              args: {
                LIST [60] {
                  elements: {
                    COMPREHENSION [61] {
                      iter_var: @it:3
                      iter_range: {
                        IDENT [62] {
                          name: @r1
                        }
                      }
                      accu_var: @ac:3
                      accu_init: {
                        CONSTANT [63] { value: false }
                      }
                      loop_condition: {
                        CALL [64] {
                          function: @not_strictly_false
                          args: {
                            CALL [65] {
                              function: !_
                              args: {
                                IDENT [66] {
                                  name: @ac:3
                                }
                              }
                            }
                          }
                        }
                      }
                      loop_step: {
                        CALL [67] {
                          function: _||_
                          args: {
                            IDENT [68] {
                              name: @ac:3
                            }
                            CALL [69] {
                              function: _>_
                              args: {
                                IDENT [70] {
                                  name: @it:3
                                }
                                CONSTANT [71] { value: 1 }
                              }
                            }
                          }
                        }
                      }
                      result: {
                        IDENT [72] {
                          name: @ac:3
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    CONSTANT [73] { value: 4 }
  }
}
Test case: MULTIPLE_MACROS_2
Source: [[1].exists(i, i > 0)] + [[1].exists(j, j > 0)] + [['a'].exists(k, k == 'a')] + [['a'].exists(l, l == 'a')] == [true, true, true, true]
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        LIST [4] {
          elements: {
            CONSTANT [5] { value: "a" }
          }
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r1
        }
      }
      result: {
        CALL [8] {
          function: _+_
          args: {
            CALL [9] {
              function: _+_
              args: {
                COMPREHENSION [10] {
                  iter_var: #unused
                  iter_range: {
                    LIST [11] {
                      elements: {
                      }
                    }
                  }
                  accu_var: @r0
                  accu_init: {
                    LIST [12] {
                      elements: {
                        CONSTANT [13] { value: 1 }
                      }
                    }
                  }
                  loop_condition: {
                    CONSTANT [14] { value: false }
                  }
                  loop_step: {
                    IDENT [15] {
                      name: @r0
                    }
                  }
                  result: {
                    CALL [16] {
                      function: _+_
                      args: {
                        LIST [17] {
                          elements: {
                            COMPREHENSION [18] {
                              iter_var: @it:0
                              iter_range: {
                                IDENT [19] {
                                  name: @r0
                                }
                              }
                              accu_var: @ac:0
                              accu_init: {
                                CONSTANT [20] { value: false }
                              }
                              loop_condition: {
                                CALL [21] {
                                  function: @not_strictly_false
                                  args: {
                                    CALL [22] {
                                      function: !_
                                      args: {
                                        IDENT [23] {
                                          name: @ac:0
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                              loop_step: {
                                CALL [24] {
                                  function: _||_
                                  args: {
                                    IDENT [25] {
                                      name: @ac:0
                                    }
                                    CALL [26] {
                                      function: _>_
                                      args: {
                                        IDENT [27] {
                                          name: @it:0
                                        }
                                        CONSTANT [28] { value: 0 }
                                      }
                                    }
                                  }
                                }
                              }
                              result: {
                                IDENT [29] {
                                  name: @ac:0
                                }
                              }
                            }
                          }
                        }
                        LIST [30] {
                          elements: {
                            COMPREHENSION [31] {
                              iter_var: @it:1
                              iter_range: {
                                IDENT [32] {
                                  name: @r0
                                }
                              }
                              accu_var: @ac:1
                              accu_init: {
                                CONSTANT [33] { value: false }
                              }
                              loop_condition: {
                                CALL [34] {
                                  function: @not_strictly_false
                                  args: {
                                    CALL [35] {
                                      function: !_
                                      args: {
                                        IDENT [36] {
                                          name: @ac:1
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                              loop_step: {
                                CALL [37] {
                                  function: _||_
                                  args: {
                                    IDENT [38] {
                                      name: @ac:1
                                    }
                                    CALL [39] {
                                      function: _>_
                                      args: {
                                        IDENT [40] {
                                          name: @it:1
                                        }
                                        CONSTANT [41] { value: 0 }
                                      }
                                    }
                                  }
                                }
                              }
                              result: {
                                IDENT [42] {
                                  name: @ac:1
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
                LIST [43] {
                  elements: {
                    COMPREHENSION [44] {
                      iter_var: @it:2
                      iter_range: {
                        IDENT [45] {
                          name: @r1
                        }
                      }
                      accu_var: @ac:2
                      accu_init: {
                        CONSTANT [46] { value: false }
                      }
                      loop_condition: {
                        CALL [47] {
                          function: @not_strictly_false
                          args: {
                            CALL [48] {
                              function: !_
                              args: {
                                IDENT [49] {
                                  name: @ac:2
                                }
                              }
                            }
                          }
                        }
                      }
                      loop_step: {
                        CALL [50] {
                          function: _||_
                          args: {
                            IDENT [51] {
                              name: @ac:2
                            }
                            CALL [52] {
                              function: _==_
                              args: {
                                IDENT [53] {
                                  name: @it:2
                                }
                                CONSTANT [54] { value: "a" }
                              }
                            }
                          }
                        }
                      }
                      result: {
                        IDENT [55] {
                          name: @ac:2
                        }
                      }
                    }
                  }
                }
              }
            }
            LIST [56] {
              elements: {
                COMPREHENSION [57] {
                  iter_var: @it:3
                  iter_range: {
                    IDENT [58] {
                      name: @r1
                    }
                  }
                  accu_var: @ac:3
                  accu_init: {
                    CONSTANT [59] { value: false }
                  }
                  loop_condition: {
                    CALL [60] {
                      function: @not_strictly_false
                      args: {
                        CALL [61] {
                          function: !_
                          args: {
                            IDENT [62] {
                              name: @ac:3
                            }
                          }
                        }
                      }
                    }
                  }
                  loop_step: {
                    CALL [63] {
                      function: _||_
                      args: {
                        IDENT [64] {
                          name: @ac:3
                        }
                        CALL [65] {
                          function: _==_
                          args: {
                            IDENT [66] {
                              name: @it:3
                            }
                            CONSTANT [67] { value: "a" }
                          }
                        }
                      }
                    }
                  }
                  result: {
                    IDENT [68] {
                      name: @ac:3
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    LIST [69] {
      elements: {
        CONSTANT [70] { value: true }
        CONSTANT [71] { value: true }
        CONSTANT [72] { value: true }
        CONSTANT [73] { value: true }
      }
    }
  }
}
Test case: MULTIPLE_MACROS_3
Source: [1].exists(i, i > 0) && [1].exists(j, j > 0) && [1].exists(k, k > 1) && [2].exists(l, l > 1)
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    LIST [3] {
      elements: {
        CONSTANT [4] { value: 1 }
      }
    }
  }
  loop_condition: {
    CONSTANT [5] { value: false }
  }
  loop_step: {
    IDENT [6] {
      name: @r0
    }
  }
  result: {
    CALL [7] {
      function: _&&_
      args: {
        CALL [8] {
          function: _&&_
          args: {
            COMPREHENSION [9] {
              iter_var: @it:0
              iter_range: {
                IDENT [10] {
                  name: @r0
                }
              }
              accu_var: @ac:0
              accu_init: {
                CONSTANT [11] { value: false }
              }
              loop_condition: {
                CALL [12] {
                  function: @not_strictly_false
                  args: {
                    CALL [13] {
                      function: !_
                      args: {
                        IDENT [14] {
                          name: @ac:0
                        }
                      }
                    }
                  }
                }
              }
              loop_step: {
                CALL [15] {
                  function: _||_
                  args: {
                    IDENT [16] {
                      name: @ac:0
                    }
                    CALL [17] {
                      function: _>_
                      args: {
                        IDENT [18] {
                          name: @it:0
                        }
                        CONSTANT [19] { value: 0 }
                      }
                    }
                  }
                }
              }
              result: {
                IDENT [20] {
                  name: @ac:0
                }
              }
            }
            COMPREHENSION [21] {
              iter_var: @it:1
              iter_range: {
                IDENT [22] {
                  name: @r0
                }
              }
              accu_var: @ac:1
              accu_init: {
                CONSTANT [23] { value: false }
              }
              loop_condition: {
                CALL [24] {
                  function: @not_strictly_false
                  args: {
                    CALL [25] {
                      function: !_
                      args: {
                        IDENT [26] {
                          name: @ac:1
                        }
                      }
                    }
                  }
                }
              }
              loop_step: {
                CALL [27] {
                  function: _||_
                  args: {
                    IDENT [28] {
                      name: @ac:1
                    }
                    CALL [29] {
                      function: _>_
                      args: {
                        IDENT [30] {
                          name: @it:1
                        }
                        CONSTANT [31] { value: 0 }
                      }
                    }
                  }
                }
              }
              result: {
                IDENT [32] {
                  name: @ac:1
                }
              }
            }
          }
        }
        CALL [33] {
          function: _&&_
          args: {
            COMPREHENSION [34] {
              iter_var: @it:2
              iter_range: {
                IDENT [35] {
                  name: @r0
                }
              }
              accu_var: @ac:2
              accu_init: {
                CONSTANT [36] { value: false }
              }
              loop_condition: {
                CALL [37] {
                  function: @not_strictly_false
                  args: {
                    CALL [38] {
                      function: !_
                      args: {
                        IDENT [39] {
                          name: @ac:2
                        }
                      }
                    }
                  }
                }
              }
              loop_step: {
                CALL [40] {
                  function: _||_
                  args: {
                    IDENT [41] {
                      name: @ac:2
                    }
                    CALL [42] {
                      function: _>_
                      args: {
                        IDENT [43] {
                          name: @it:2
                        }
                        CONSTANT [44] { value: 1 }
                      }
                    }
                  }
                }
              }
              result: {
                IDENT [45] {
                  name: @ac:2
                }
              }
            }
            COMPREHENSION [46] {
              iter_var: @it:3
              iter_range: {
                LIST [47] {
                  elements: {
                    CONSTANT [48] { value: 2 }
                  }
                }
              }
              accu_var: @ac:3
              accu_init: {
                CONSTANT [49] { value: false }
              }
              loop_condition: {
                CALL [50] {
                  function: @not_strictly_false
                  args: {
                    CALL [51] {
                      function: !_
                      args: {
                        IDENT [52] {
                          name: @ac:3
                        }
                      }
                    }
                  }
                }
              }
              loop_step: {
                CALL [53] {
                  function: _||_
                  args: {
                    IDENT [54] {
                      name: @ac:3
                    }
                    CALL [55] {
                      function: _>_
                      args: {
                        IDENT [56] {
                          name: @it:3
                        }
                        CONSTANT [57] { value: 1 }
                      }
                    }
                  }
                }
              }
              result: {
                IDENT [58] {
                  name: @ac:3
                }
              }
            }
          }
        }
      }
    }
  }
}
Test case: NESTED_MACROS
Source: [1,2,3].map(i, [1, 2, 3].map(i, i + 1)) == [[2, 3, 4], [2, 3, 4], [2, 3, 4]]
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        LIST [4] {
          elements: {
            CONSTANT [5] { value: 1 }
            CONSTANT [6] { value: 2 }
            CONSTANT [7] { value: 3 }
          }
        }
      }
      loop_condition: {
        CONSTANT [8] { value: false }
      }
      loop_step: {
        IDENT [9] {
          name: @r0
        }
      }
      result: {
        COMPREHENSION [10] {
          iter_var: @it:1
          iter_range: {
            IDENT [11] {
              name: @r0
            }
          }
          accu_var: @ac:1
          accu_init: {
            LIST [12] {
              elements: {
              }
            }
          }
          loop_condition: {
            CONSTANT [13] { value: true }
          }
          loop_step: {
            CALL [14] {
              function: _+_
              args: {
                IDENT [15] {
                  name: @ac:1
                }
                LIST [16] {
                  elements: {
                    COMPREHENSION [17] {
                      iter_var: @it:0
                      iter_range: {
                        IDENT [18] {
                          name: @r0
                        }
                      }
                      accu_var: @ac:0
                      accu_init: {
                        LIST [19] {
                          elements: {
                          }
                        }
                      }
                      loop_condition: {
                        CONSTANT [20] { value: true }
                      }
                      loop_step: {
                        CALL [21] {
                          function: _+_
                          args: {
                            IDENT [22] {
                              name: @ac:0
                            }
                            LIST [23] {
                              elements: {
                                CALL [24] {
                                  function: _+_
                                  args: {
                                    IDENT [25] {
                                      name: @it:0
                                    }
                                    CONSTANT [26] { value: 1 }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                      result: {
                        IDENT [27] {
                          name: @ac:0
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          result: {
            IDENT [28] {
              name: @ac:1
            }
          }
        }
      }
    }
    COMPREHENSION [29] {
      iter_var: #unused
      iter_range: {
        LIST [30] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        LIST [31] {
          elements: {
            CONSTANT [32] { value: 2 }
            CONSTANT [33] { value: 3 }
            CONSTANT [34] { value: 4 }
          }
        }
      }
      loop_condition: {
        CONSTANT [35] { value: false }
      }
      loop_step: {
        IDENT [36] {
          name: @r1
        }
      }
      result: {
        LIST [37] {
          elements: {
            IDENT [38] {
              name: @r1
            }
            IDENT [39] {
              name: @r1
            }
            IDENT [40] {
              name: @r1
            }
          }
        }
      }
    }
  }
}
Test case: NESTED_MACROS_2
Source: [1, 2].map(y, [1, 2, 3].filter(x, x == y)) == [[1], [2]]
=====>
CALL [31] {
  function: _==_
  args: {
    COMPREHENSION [30] {
      iter_var: y
      iter_range: {
        LIST [1] {
          elements: {
            CONSTANT [2] { value: 1 }
            CONSTANT [3] { value: 2 }
          }
        }
      }
      accu_var: @result
      accu_init: {
        LIST [24] {
          elements: {
          }
        }
      }
      loop_condition: {
        CONSTANT [25] { value: true }
      }
      loop_step: {
        CALL [28] {
          function: _+_
          args: {
            IDENT [26] {
              name: @result
            }
            LIST [27] {
              elements: {
                COMPREHENSION [23] {
                  iter_var: x
                  iter_range: {
                    LIST [6] {
                      elements: {
                        CONSTANT [7] { value: 1 }
                        CONSTANT [8] { value: 2 }
                        CONSTANT [9] { value: 3 }
                      }
                    }
                  }
                  accu_var: @result
                  accu_init: {
                    LIST [15] {
                      elements: {
                      }
                    }
                  }
                  loop_condition: {
                    CONSTANT [16] { value: true }
                  }
                  loop_step: {
                    CALL [21] {
                      function: _?_:_
                      args: {
                        CALL [13] {
                          function: _==_
                          args: {
                            IDENT [12] {
                              name: x
                            }
                            IDENT [14] {
                              name: y
                            }
                          }
                        }
                        CALL [19] {
                          function: _+_
                          args: {
                            IDENT [17] {
                              name: @result
                            }
                            LIST [18] {
                              elements: {
                                IDENT [11] {
                                  name: x
                                }
                              }
                            }
                          }
                        }
                        IDENT [20] {
                          name: @result
                        }
                      }
                    }
                  }
                  result: {
                    IDENT [22] {
                      name: @result
                    }
                  }
                }
              }
            }
          }
        }
      }
      result: {
        IDENT [29] {
          name: @result
        }
      }
    }
    LIST [32] {
      elements: {
        LIST [33] {
          elements: {
            CONSTANT [34] { value: 1 }
          }
        }
        LIST [35] {
          elements: {
            CONSTANT [36] { value: 2 }
          }
        }
      }
    }
  }
}
Test case: ADJACENT_NESTED_MACROS
Source: [1,2,3].map(i, [1, 2, 3].map(i, i + 1)) == [1,2,3].map(j, [1, 2, 3].map(j, j + 1))
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    LIST [3] {
      elements: {
        CONSTANT [4] { value: 1 }
        CONSTANT [5] { value: 2 }
        CONSTANT [6] { value: 3 }
      }
    }
  }
  loop_condition: {
    CONSTANT [7] { value: false }
  }
  loop_step: {
    IDENT [8] {
      name: @r0
    }
  }
  result: {
    CALL [9] {
      function: _==_
      args: {
        COMPREHENSION [10] {
          iter_var: @it:1
          iter_range: {
            IDENT [11] {
              name: @r0
            }
          }
          accu_var: @ac:1
          accu_init: {
            LIST [12] {
              elements: {
              }
            }
          }
          loop_condition: {
            CONSTANT [13] { value: true }
          }
          loop_step: {
            CALL [14] {
              function: _+_
              args: {
                IDENT [15] {
                  name: @ac:1
                }
                LIST [16] {
                  elements: {
                    COMPREHENSION [17] {
                      iter_var: @it:0
                      iter_range: {
                        IDENT [18] {
                          name: @r0
                        }
                      }
                      accu_var: @ac:0
                      accu_init: {
                        LIST [19] {
                          elements: {
                          }
                        }
                      }
                      loop_condition: {
                        CONSTANT [20] { value: true }
                      }
                      loop_step: {
                        CALL [21] {
                          function: _+_
                          args: {
                            IDENT [22] {
                              name: @ac:0
                            }
                            LIST [23] {
                              elements: {
                                CALL [24] {
                                  function: _+_
                                  args: {
                                    IDENT [25] {
                                      name: @it:0
                                    }
                                    CONSTANT [26] { value: 1 }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                      result: {
                        IDENT [27] {
                          name: @ac:0
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          result: {
            IDENT [28] {
              name: @ac:1
            }
          }
        }
        COMPREHENSION [29] {
          iter_var: @it:3
          iter_range: {
            IDENT [30] {
              name: @r0
            }
          }
          accu_var: @ac:3
          accu_init: {
            LIST [31] {
              elements: {
              }
            }
          }
          loop_condition: {
            CONSTANT [32] { value: true }
          }
          loop_step: {
            CALL [33] {
              function: _+_
              args: {
                IDENT [34] {
                  name: @ac:3
                }
                LIST [35] {
                  elements: {
                    COMPREHENSION [36] {
                      iter_var: @it:2
                      iter_range: {
                        IDENT [37] {
                          name: @r0
                        }
                      }
                      accu_var: @ac:2
                      accu_init: {
                        LIST [38] {
                          elements: {
                          }
                        }
                      }
                      loop_condition: {
                        CONSTANT [39] { value: true }
                      }
                      loop_step: {
                        CALL [40] {
                          function: _+_
                          args: {
                            IDENT [41] {
                              name: @ac:2
                            }
                            LIST [42] {
                              elements: {
                                CALL [43] {
                                  function: _+_
                                  args: {
                                    IDENT [44] {
                                      name: @it:2
                                    }
                                    CONSTANT [45] { value: 1 }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                      result: {
                        IDENT [46] {
                          name: @ac:2
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          result: {
            IDENT [47] {
              name: @ac:3
            }
          }
        }
      }
    }
  }
}
Test case: INCLUSION_LIST
Source: 1 in [1,2,3] && 2 in [1,2,3] && 3 in [3, [1,2,3]] && 1 in [1,2,3]
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    LIST [3] {
      elements: {
        CONSTANT [4] { value: 1 }
        CONSTANT [5] { value: 2 }
        CONSTANT [6] { value: 3 }
      }
    }
  }
  loop_condition: {
    CONSTANT [7] { value: false }
  }
  loop_step: {
    IDENT [8] {
      name: @r0
    }
  }
  result: {
    COMPREHENSION [9] {
      iter_var: #unused
      iter_range: {
        LIST [10] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        CALL [11] {
          function: @in
          args: {
            CONSTANT [12] { value: 1 }
            IDENT [13] {
              name: @r0
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [14] { value: false }
      }
      loop_step: {
        IDENT [15] {
          name: @r1
        }
      }
      result: {
        CALL [16] {
          function: _&&_
          args: {
            CALL [17] {
              function: _&&_
              args: {
                IDENT [18] {
                  name: @r1
                }
                CALL [19] {
                  function: @in
                  args: {
                    CONSTANT [20] { value: 2 }
                    IDENT [21] {
                      name: @r0
                    }
                  }
                }
              }
            }
            CALL [22] {
              function: _&&_
              args: {
                CALL [23] {
                  function: @in
                  args: {
                    CONSTANT [24] { value: 3 }
                    LIST [25] {
                      elements: {
                        CONSTANT [26] { value: 3 }
                        IDENT [27] {
                          name: @r0
                        }
                      }
                    }
                  }
                }
                IDENT [28] {
                  name: @r1
                }
              }
            }
          }
        }
      }
    }
  }
}
Test case: INCLUSION_MAP
Source: 2 in {'a': 1, 2: {true: false}, 3: {true: false}}
=====>
CALL [1] {
  function: @in
  args: {
    CONSTANT [2] { value: 2 }
    COMPREHENSION [3] {
      iter_var: #unused
      iter_range: {
        LIST [4] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        MAP [5] {
          MAP_ENTRY [6] {
            key: {
              CONSTANT [7] { value: true }
            }
            value: {
              CONSTANT [8] { value: false }
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [9] { value: false }
      }
      loop_step: {
        IDENT [10] {
          name: @r0
        }
      }
      result: {
        MAP [11] {
          MAP_ENTRY [12] {
            key: {
              CONSTANT [13] { value: "a" }
            }
            value: {
              CONSTANT [14] { value: 1 }
            }
          }
          MAP_ENTRY [15] {
            key: {
              CONSTANT [16] { value: 2 }
            }
            value: {
              IDENT [17] {
                name: @r0
              }
            }
          }
          MAP_ENTRY [18] {
            key: {
              CONSTANT [19] { value: 3 }
            }
            value: {
              IDENT [20] {
                name: @r0
              }
            }
          }
        }
      }
    }
  }
}
Test case: MACRO_ITER_VAR_NOT_REFERENCED
Source: [1,2].map(i, [1, 2].map(i, [3,4])) == [[[3, 4], [3, 4]], [[3, 4], [3, 4]]]
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r1
  accu_init: {
    LIST [3] {
      elements: {
        CONSTANT [4] { value: 3 }
        CONSTANT [5] { value: 4 }
      }
    }
  }
  loop_condition: {
    CONSTANT [6] { value: false }
  }
  loop_step: {
    IDENT [7] {
      name: @r1
    }
  }
  result: {
    CALL [8] {
      function: _==_
      args: {
        COMPREHENSION [9] {
          iter_var: #unused
          iter_range: {
            LIST [10] {
              elements: {
              }
            }
          }
          accu_var: @r0
          accu_init: {
            LIST [11] {
              elements: {
                CONSTANT [12] { value: 1 }
                CONSTANT [13] { value: 2 }
              }
            }
          }
          loop_condition: {
            CONSTANT [14] { value: false }
          }
          loop_step: {
            IDENT [15] {
              name: @r0
            }
          }
          result: {
            COMPREHENSION [16] {
              iter_var: @it:1
              iter_range: {
                IDENT [17] {
                  name: @r0
                }
              }
              accu_var: @ac:1
              accu_init: {
                LIST [18] {
                  elements: {
                  }
                }
              }
              loop_condition: {
                CONSTANT [19] { value: true }
              }
              loop_step: {
                CALL [20] {
                  function: _+_
                  args: {
                    IDENT [21] {
                      name: @ac:1
                    }
                    LIST [22] {
                      elements: {
                        COMPREHENSION [23] {
                          iter_var: @it:0
                          iter_range: {
                            IDENT [24] {
                              name: @r0
                            }
                          }
                          accu_var: @ac:0
                          accu_init: {
                            LIST [25] {
                              elements: {
                              }
                            }
                          }
                          loop_condition: {
                            CONSTANT [26] { value: true }
                          }
                          loop_step: {
                            CALL [27] {
                              function: _+_
                              args: {
                                IDENT [28] {
                                  name: @ac:0
                                }
                                LIST [29] {
                                  elements: {
                                    IDENT [30] {
                                      name: @r1
                                    }
                                  }
                                }
                              }
                            }
                          }
                          result: {
                            IDENT [31] {
                              name: @ac:0
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
              result: {
                IDENT [32] {
                  name: @ac:1
                }
              }
            }
          }
        }
        COMPREHENSION [33] {
          iter_var: #unused
          iter_range: {
            LIST [34] {
              elements: {
              }
            }
          }
          accu_var: @r2
          accu_init: {
            LIST [35] {
              elements: {
                IDENT [36] {
                  name: @r1
                }
                IDENT [37] {
                  name: @r1
                }
              }
            }
          }
          loop_condition: {
            CONSTANT [38] { value: false }
          }
          loop_step: {
            IDENT [39] {
              name: @r2
            }
          }
          result: {
            LIST [40] {
              elements: {
                IDENT [41] {
                  name: @r2
                }
                IDENT [42] {
                  name: @r2
                }
              }
            }
          }
        }
      }
    }
  }
}
Test case: MACRO_SHADOWED_VARIABLE
Source: [x - 1 > 3 ? x - 1 : 5].exists(x, x - 1 > 3) || x - 1 > 3
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    CALL [3] {
      function: _-_
      args: {
        IDENT [4] {
          name: x
        }
        CONSTANT [5] { value: 1 }
      }
    }
  }
  loop_condition: {
    CONSTANT [6] { value: false }
  }
  loop_step: {
    IDENT [7] {
      name: @r0
    }
  }
  result: {
    COMPREHENSION [8] {
      iter_var: #unused
      iter_range: {
        LIST [9] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        CALL [10] {
          function: _>_
          args: {
            IDENT [11] {
              name: @r0
            }
            CONSTANT [12] { value: 3 }
          }
        }
      }
      loop_condition: {
        CONSTANT [13] { value: false }
      }
      loop_step: {
        IDENT [14] {
          name: @r1
        }
      }
      result: {
        CALL [15] {
          function: _||_
          args: {
            COMPREHENSION [16] {
              iter_var: @it:0
              iter_range: {
                LIST [17] {
                  elements: {
                    CALL [18] {
                      function: _?_:_
                      args: {
                        IDENT [19] {
                          name: @r1
                        }
                        IDENT [20] {
                          name: @r0
                        }
                        CONSTANT [21] { value: 5 }
                      }
                    }
                  }
                }
              }
              accu_var: @ac:0
              accu_init: {
                CONSTANT [22] { value: false }
              }
              loop_condition: {
                CALL [23] {
                  function: @not_strictly_false
                  args: {
                    CALL [24] {
                      function: !_
                      args: {
                        IDENT [25] {
                          name: @ac:0
                        }
                      }
                    }
                  }
                }
              }
              loop_step: {
                CALL [26] {
                  function: _||_
                  args: {
                    IDENT [27] {
                      name: @ac:0
                    }
                    CALL [28] {
                      function: _>_
                      args: {
                        CALL [29] {
                          function: _-_
                          args: {
                            IDENT [30] {
                              name: @it:0
                            }
                            CONSTANT [31] { value: 1 }
                          }
                        }
                        CONSTANT [32] { value: 3 }
                      }
                    }
                  }
                }
              }
              result: {
                IDENT [33] {
                  name: @ac:0
                }
              }
            }
            IDENT [34] {
              name: @r1
            }
          }
        }
      }
    }
  }
}
Test case: MACRO_SHADOWED_VARIABLE_2
Source: ["foo", "bar"].map(x, [x + x, x + x]).map(x, [x + x, x + x])
=====>
COMPREHENSION [35] {
  iter_var: x
  iter_range: {
    COMPREHENSION [19] {
      iter_var: x
      iter_range: {
        LIST [1] {
          elements: {
            CONSTANT [2] { value: "foo" }
            CONSTANT [3] { value: "bar" }
          }
        }
      }
      accu_var: @result
      accu_init: {
        LIST [13] {
          elements: {
          }
        }
      }
      loop_condition: {
        CONSTANT [14] { value: true }
      }
      loop_step: {
        CALL [17] {
          function: _+_
          args: {
            IDENT [15] {
              name: @result
            }
            LIST [16] {
              elements: {
                LIST [6] {
                  elements: {
                    CALL [8] {
                      function: _+_
                      args: {
                        IDENT [7] {
                          name: x
                        }
                        IDENT [9] {
                          name: x
                        }
                      }
                    }
                    CALL [11] {
                      function: _+_
                      args: {
                        IDENT [10] {
                          name: x
                        }
                        IDENT [12] {
                          name: x
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
      result: {
        IDENT [18] {
          name: @result
        }
      }
    }
  }
  accu_var: @result
  accu_init: {
    LIST [29] {
      elements: {
      }
    }
  }
  loop_condition: {
    CONSTANT [30] { value: true }
  }
  loop_step: {
    CALL [33] {
      function: _+_
      args: {
        IDENT [31] {
          name: @result
        }
        LIST [32] {
          elements: {
            LIST [22] {
              elements: {
                CALL [24] {
                  function: _+_
                  args: {
                    IDENT [23] {
                      name: x
                    }
                    IDENT [25] {
                      name: x
                    }
                  }
                }
                CALL [27] {
                  function: _+_
                  args: {
                    IDENT [26] {
                      name: x
                    }
                    IDENT [28] {
                      name: x
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  result: {
    IDENT [34] {
      name: @result
    }
  }
}
Test case: PRESENCE_TEST
Source: has({'a': true}.a) && {'a':true}['a']
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    MAP [3] {
      MAP_ENTRY [4] {
        key: {
          CONSTANT [5] { value: "a" }
        }
        value: {
          CONSTANT [6] { value: true }
        }
      }
    }
  }
  loop_condition: {
    CONSTANT [7] { value: false }
  }
  loop_step: {
    IDENT [8] {
      name: @r0
    }
  }
  result: {
    CALL [9] {
      function: _&&_
      args: {
        SELECT [10] {
          IDENT [11] {
            name: @r0
          }.a~presence_test
        }
        CALL [12] {
          function: _[_]
          args: {
            IDENT [13] {
              name: @r0
            }
            CONSTANT [14] { value: "a" }
          }
        }
      }
    }
  }
}
Test case: PRESENCE_TEST_2
Source: has({'a': true}.a) && has({'a': true}.a)
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    SELECT [3] {
      MAP [4] {
        MAP_ENTRY [5] {
          key: {
            CONSTANT [6] { value: "a" }
          }
          value: {
            CONSTANT [7] { value: true }
          }
        }
      }.a~presence_test
    }
  }
  loop_condition: {
    CONSTANT [8] { value: false }
  }
  loop_step: {
    IDENT [9] {
      name: @r0
    }
  }
  result: {
    CALL [10] {
      function: _&&_
      args: {
        IDENT [11] {
          name: @r0
        }
        IDENT [12] {
          name: @r0
        }
      }
    }
  }
}
Test case: PRESENCE_TEST_WITH_TERNARY
Source: (has(msg.oneof_type.payload) ? msg.oneof_type.payload.single_int64 : 0) == 10
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          IDENT [5] {
            name: msg
          }.oneof_type
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r0
        }
      }
      result: {
        CALL [8] {
          function: _?_:_
          args: {
            SELECT [9] {
              IDENT [10] {
                name: @r0
              }.payload~presence_test
            }
            SELECT [11] {
              SELECT [12] {
                IDENT [13] {
                  name: @r0
                }.payload
              }.single_int64
            }
            CONSTANT [14] { value: 0 }
          }
        }
      }
    }
    CONSTANT [15] { value: 10 }
  }
}
Test case: PRESENCE_TEST_WITH_TERNARY_2
Source: (has(msg.oneof_type.payload) ? msg.oneof_type.payload.single_int64 : msg.oneof_type.payload.single_int64 * 0) == 10
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          IDENT [5] {
            name: msg
          }.oneof_type
        }
      }
      loop_condition: {
        CONSTANT [6] { value: false }
      }
      loop_step: {
        IDENT [7] {
          name: @r0
        }
      }
      result: {
        COMPREHENSION [8] {
          iter_var: #unused
          iter_range: {
            LIST [9] {
              elements: {
              }
            }
          }
          accu_var: @r1
          accu_init: {
            SELECT [10] {
              SELECT [11] {
                IDENT [12] {
                  name: @r0
                }.payload
              }.single_int64
            }
          }
          loop_condition: {
            CONSTANT [13] { value: false }
          }
          loop_step: {
            IDENT [14] {
              name: @r1
            }
          }
          result: {
            CALL [15] {
              function: _?_:_
              args: {
                SELECT [16] {
                  IDENT [17] {
                    name: @r0
                  }.payload~presence_test
                }
                IDENT [18] {
                  name: @r1
                }
                CALL [19] {
                  function: _*_
                  args: {
                    IDENT [20] {
                      name: @r1
                    }
                    CONSTANT [21] { value: 0 }
                  }
                }
              }
            }
          }
        }
      }
    }
    CONSTANT [22] { value: 10 }
  }
}
Test case: PRESENCE_TEST_WITH_TERNARY_3
Source: (has(msg.oneof_type.payload.single_int64) ? msg.oneof_type.payload.single_int64 : msg.oneof_type.payload.single_int64 * 0) == 10
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          SELECT [5] {
            IDENT [6] {
              name: msg
            }.oneof_type
          }.payload
        }
      }
      loop_condition: {
        CONSTANT [7] { value: false }
      }
      loop_step: {
        IDENT [8] {
          name: @r0
        }
      }
      result: {
        COMPREHENSION [9] {
          iter_var: #unused
          iter_range: {
            LIST [10] {
              elements: {
              }
            }
          }
          accu_var: @r1
          accu_init: {
            SELECT [11] {
              IDENT [12] {
                name: @r0
              }.single_int64
            }
          }
          loop_condition: {
            CONSTANT [13] { value: false }
          }
          loop_step: {
            IDENT [14] {
              name: @r1
            }
          }
          result: {
            CALL [15] {
              function: _?_:_
              args: {
                SELECT [16] {
                  IDENT [17] {
                    name: @r0
                  }.single_int64~presence_test
                }
                IDENT [18] {
                  name: @r1
                }
                CALL [19] {
                  function: _*_
                  args: {
                    IDENT [20] {
                      name: @r1
                    }
                    CONSTANT [21] { value: 0 }
                  }
                }
              }
            }
          }
        }
      }
    }
    CONSTANT [22] { value: 10 }
  }
}
Test case: PRESENCE_TEST_WITH_TERNARY_NESTED
Source: (has(msg.oneof_type) && has(msg.oneof_type.payload) && has(msg.oneof_type.payload.single_int64)) ? ((has(msg.oneof_type.payload.map_string_string) && has(msg.oneof_type.payload.map_string_string.key)) ? msg.oneof_type.payload.map_string_string.key == 'A' : false) : false
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    SELECT [3] {
      IDENT [4] {
        name: msg
      }.oneof_type
    }
  }
  loop_condition: {
    CONSTANT [5] { value: false }
  }
  loop_step: {
    IDENT [6] {
      name: @r0
    }
  }
  result: {
    COMPREHENSION [7] {
      iter_var: #unused
      iter_range: {
        LIST [8] {
          elements: {
          }
        }
      }
      accu_var: @r1
      accu_init: {
        SELECT [9] {
          IDENT [10] {
            name: @r0
          }.payload
        }
      }
      loop_condition: {
        CONSTANT [11] { value: false }
      }
      loop_step: {
        IDENT [12] {
          name: @r1
        }
      }
      result: {
        CALL [13] {
          function: _?_:_
          args: {
            CALL [14] {
              function: _&&_
              args: {
                CALL [15] {
                  function: _&&_
                  args: {
                    SELECT [16] {
                      IDENT [17] {
                        name: msg
                      }.oneof_type~presence_test
                    }
                    SELECT [18] {
                      IDENT [19] {
                        name: @r0
                      }.payload~presence_test
                    }
                  }
                }
                SELECT [20] {
                  IDENT [21] {
                    name: @r1
                  }.single_int64~presence_test
                }
              }
            }
            COMPREHENSION [22] {
              iter_var: #unused
              iter_range: {
                LIST [23] {
                  elements: {
                  }
                }
              }
              accu_var: @r2
              accu_init: {
                SELECT [24] {
                  IDENT [25] {
                    name: @r1
                  }.map_string_string
                }
              }
              loop_condition: {
                CONSTANT [26] { value: false }
              }
              loop_step: {
                IDENT [27] {
                  name: @r2
                }
              }
              result: {
                CALL [28] {
                  function: _?_:_
                  args: {
                    CALL [29] {
                      function: _&&_
                      args: {
                        SELECT [30] {
                          IDENT [31] {
                            name: @r1
                          }.map_string_string~presence_test
                        }
                        SELECT [32] {
                          IDENT [33] {
                            name: @r2
                          }.key~presence_test
                        }
                      }
                    }
                    CALL [34] {
                      function: _==_
                      args: {
                        SELECT [35] {
                          IDENT [36] {
                            name: @r2
                          }.key
                        }
                        CONSTANT [37] { value: "A" }
                      }
                    }
                    CONSTANT [38] { value: false }
                  }
                }
              }
            }
            CONSTANT [39] { value: false }
          }
        }
      }
    }
  }
}
Test case: OPTIONAL_LIST
Source: [10, ?optional.none(), [?optional.none(), ?opt_x], [?optional.none(), ?opt_x]] == [10, [5], [5]]
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        CALL [4] {
          function: optional.none
          args: {
          }
        }
      }
      loop_condition: {
        CONSTANT [5] { value: false }
      }
      loop_step: {
        IDENT [6] {
          name: @r0
        }
      }
      result: {
        COMPREHENSION [7] {
          iter_var: #unused
          iter_range: {
            LIST [8] {
              elements: {
              }
            }
          }
          accu_var: @r1
          accu_init: {
            LIST [9] {
              elements: {
                IDENT [10] {
                  name: @r0
                }
                IDENT [11] {
                  name: opt_x
                }
              }
              optional_indices: [0, 1]
            }
          }
          loop_condition: {
            CONSTANT [12] { value: false }
          }
          loop_step: {
            IDENT [13] {
              name: @r1
            }
          }
          result: {
            LIST [14] {
              elements: {
                CONSTANT [15] { value: 10 }
                IDENT [16] {
                  name: @r0
                }
                IDENT [17] {
                  name: @r1
                }
                IDENT [18] {
                  name: @r1
                }
              }
              optional_indices: [0]
            }
          }
        }
      }
    }
    COMPREHENSION [19] {
      iter_var: #unused
      iter_range: {
        LIST [20] {
          elements: {
          }
        }
      }
      accu_var: @r2
      accu_init: {
        LIST [21] {
          elements: {
            CONSTANT [22] { value: 5 }
          }
        }
      }
      loop_condition: {
        CONSTANT [23] { value: false }
      }
      loop_step: {
        IDENT [24] {
          name: @r2
        }
      }
      result: {
        LIST [25] {
          elements: {
            CONSTANT [26] { value: 10 }
            IDENT [27] {
              name: @r2
            }
            IDENT [28] {
              name: @r2
            }
          }
        }
      }
    }
  }
}
Test case: OPTIONAL_MAP
Source: {?'hello': optional.of('hello')}['hello'] + {?'hello': optional.of('hello')}['hello'] == 'hellohello'
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        CALL [4] {
          function: _[_]
          args: {
            MAP [5] {
              MAP_ENTRY [6] {
                key: {
                  CONSTANT [7] { value: "hello" }
                }
                optional_entry: true
                value: {
                  CALL [8] {
                    function: optional.of
                    args: {
                      CONSTANT [9] { value: "hello" }
                    }
                  }
                }
              }
            }
            CONSTANT [10] { value: "hello" }
          }
        }
      }
      loop_condition: {
        CONSTANT [11] { value: false }
      }
      loop_step: {
        IDENT [12] {
          name: @r0
        }
      }
      result: {
        CALL [13] {
          function: _+_
          args: {
            IDENT [14] {
              name: @r0
            }
            IDENT [15] {
              name: @r0
            }
          }
        }
      }
    }
    CONSTANT [16] { value: "hellohello" }
  }
}
Test case: OPTIONAL_MAP_CHAINED
Source: {?'key': optional.of('test')}[?'bogus'].or({'key': 'test'}[?'bogus']).orValue({'key': 'test'}['key']) == 'test'
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        MAP [4] {
          MAP_ENTRY [5] {
            key: {
              CONSTANT [6] { value: "key" }
            }
            value: {
              CONSTANT [7] { value: "test" }
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [8] { value: false }
      }
      loop_step: {
        IDENT [9] {
          name: @r0
        }
      }
      result: {
        CALL [10] {
          function: orValue
          target: {
            CALL [11] {
              function: or
              target: {
                CALL [12] {
                  function: _[?_]
                  args: {
                    MAP [13] {
                      MAP_ENTRY [14] {
                        key: {
                          CONSTANT [15] { value: "key" }
                        }
                        optional_entry: true
                        value: {
                          CALL [16] {
                            function: optional.of
                            args: {
                              CONSTANT [17] { value: "test" }
                            }
                          }
                        }
                      }
                    }
                    CONSTANT [18] { value: "bogus" }
                  }
                }
              }
              args: {
                CALL [19] {
                  function: _[?_]
                  args: {
                    IDENT [20] {
                      name: @r0
                    }
                    CONSTANT [21] { value: "bogus" }
                  }
                }
              }
            }
          }
          args: {
            CALL [22] {
              function: _[_]
              args: {
                IDENT [23] {
                  name: @r0
                }
                CONSTANT [24] { value: "key" }
              }
            }
          }
        }
      }
    }
    CONSTANT [25] { value: "test" }
  }
}
Test case: OPTIONAL_MESSAGE
Source: TestAllTypes{?single_int64: optional.ofNonZeroValue(1), ?single_int32: optional.of(4)}.single_int32 + TestAllTypes{?single_int64: optional.ofNonZeroValue(1), ?single_int32: optional.of(4)}.single_int64 == 5
=====>
CALL [1] {
  function: _==_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        STRUCT [4] {
          name: TestAllTypes
          entries: {
            ENTRY [5] {
              field_key: single_int64
              optional_entry: true
              value: {
                CALL [6] {
                  function: optional.ofNonZeroValue
                  args: {
                    CONSTANT [7] { value: 1 }
                  }
                }
              }
            }
            ENTRY [8] {
              field_key: single_int32
              optional_entry: true
              value: {
                CALL [9] {
                  function: optional.of
                  args: {
                    CONSTANT [10] { value: 4 }
                  }
                }
              }
            }
          }
        }
      }
      loop_condition: {
        CONSTANT [11] { value: false }
      }
      loop_step: {
        IDENT [12] {
          name: @r0
        }
      }
      result: {
        CALL [13] {
          function: _+_
          args: {
            SELECT [14] {
              IDENT [15] {
                name: @r0
              }.single_int32
            }
            SELECT [16] {
              IDENT [17] {
                name: @r0
              }.single_int64
            }
          }
        }
      }
    }
    CONSTANT [18] { value: 5 }
  }
}
Test case: CALL
Source: ('h' + 'e' + 'l' + 'l' + 'o' + ' world').matches('h' + 'e' + 'l' + 'l' + 'o')
=====>
COMPREHENSION [1] {
  iter_var: #unused
  iter_range: {
    LIST [2] {
      elements: {
      }
    }
  }
  accu_var: @r0
  accu_init: {
    CALL [3] {
      function: _+_
      args: {
        CALL [4] {
          function: _+_
          args: {
            CALL [5] {
              function: _+_
              args: {
                CALL [6] {
                  function: _+_
                  args: {
                    CONSTANT [7] { value: "h" }
                    CONSTANT [8] { value: "e" }
                  }
                }
                CONSTANT [9] { value: "l" }
              }
            }
            CONSTANT [10] { value: "l" }
          }
        }
        CONSTANT [11] { value: "o" }
      }
    }
  }
  loop_condition: {
    CONSTANT [12] { value: false }
  }
  loop_step: {
    IDENT [13] {
      name: @r0
    }
  }
  result: {
    CALL [14] {
      function: matches
      target: {
        CALL [15] {
          function: _+_
          args: {
            IDENT [16] {
              name: @r0
            }
            CONSTANT [17] { value: " world" }
          }
        }
      }
      args: {
        IDENT [18] {
          name: @r0
        }
      }
    }
  }
}
Test case: CALL_ARGUMENT_NESTED_NO_COMMON_SUBEXPR
Source: 'hello world'.matches('h' + 'e' + 'l' + 'l' + 'o')
=====>
CALL [2] {
  function: matches
  target: {
    CONSTANT [1] { value: "hello world" }
  }
  args: {
    CALL [10] {
      function: _+_
      args: {
        CALL [8] {
          function: _+_
          args: {
            CALL [6] {
              function: _+_
              args: {
                CALL [4] {
                  function: _+_
                  args: {
                    CONSTANT [3] { value: "h" }
                    CONSTANT [5] { value: "e" }
                  }
                }
                CONSTANT [7] { value: "l" }
              }
            }
            CONSTANT [9] { value: "l" }
          }
        }
        CONSTANT [11] { value: "o" }
      }
    }
  }
}
Test case: CALL_TARGET_NESTED_NO_COMMON_SUBEXPR
Source: ('h' + 'e' + 'l' + 'l' + 'o' + ' world').matches('hello')
=====>
CALL [12] {
  function: matches
  target: {
    CALL [10] {
      function: _+_
      args: {
        CALL [8] {
          function: _+_
          args: {
            CALL [6] {
              function: _+_
              args: {
                CALL [4] {
                  function: _+_
                  args: {
                    CALL [2] {
                      function: _+_
                      args: {
                        CONSTANT [1] { value: "h" }
                        CONSTANT [3] { value: "e" }
                      }
                    }
                    CONSTANT [5] { value: "l" }
                  }
                }
                CONSTANT [7] { value: "l" }
              }
            }
            CONSTANT [9] { value: "o" }
          }
        }
        CONSTANT [11] { value: " world" }
      }
    }
  }
  args: {
    CONSTANT [13] { value: "hello" }
  }
}
Test case: CALL_BOTH_ARGUMENT_TARGET_NESTED_NO_COMMON_SUBEXPR
Source: ('h' + 'e' + 'l' + 'l' + 'o' + ' world').matches('w' + 'o' + 'r' + 'l' + 'd')
=====>
CALL [12] {
  function: matches
  target: {
    CALL [10] {
      function: _+_
      args: {
        CALL [8] {
          function: _+_
          args: {
            CALL [6] {
              function: _+_
              args: {
                CALL [4] {
                  function: _+_
                  args: {
                    CALL [2] {
                      function: _+_
                      args: {
                        CONSTANT [1] { value: "h" }
                        CONSTANT [3] { value: "e" }
                      }
                    }
                    CONSTANT [5] { value: "l" }
                  }
                }
                CONSTANT [7] { value: "l" }
              }
            }
            CONSTANT [9] { value: "o" }
          }
        }
        CONSTANT [11] { value: " world" }
      }
    }
  }
  args: {
    CALL [20] {
      function: _+_
      args: {
        CALL [18] {
          function: _+_
          args: {
            CALL [16] {
              function: _+_
              args: {
                CALL [14] {
                  function: _+_
                  args: {
                    CONSTANT [13] { value: "w" }
                    CONSTANT [15] { value: "o" }
                  }
                }
                CONSTANT [17] { value: "r" }
              }
            }
            CONSTANT [19] { value: "l" }
          }
        }
        CONSTANT [21] { value: "d" }
      }
    }
  }
}
Test case: CUSTOM_FUNCTION_INELIMINABLE
Source: non_pure_custom_func(msg.oneof_type.payload.single_int64) + non_pure_custom_func(msg.oneof_type.payload.single_int32) + non_pure_custom_func(msg.oneof_type.payload.single_int64) + non_pure_custom_func(msg.single_int64)
=====>
CALL [1] {
  function: _+_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          SELECT [5] {
            IDENT [6] {
              name: msg
            }.oneof_type
          }.payload
        }
      }
      loop_condition: {
        CONSTANT [7] { value: false }
      }
      loop_step: {
        IDENT [8] {
          name: @r0
        }
      }
      result: {
        COMPREHENSION [9] {
          iter_var: #unused
          iter_range: {
            LIST [10] {
              elements: {
              }
            }
          }
          accu_var: @r1
          accu_init: {
            SELECT [11] {
              IDENT [12] {
                name: @r0
              }.single_int64
            }
          }
          loop_condition: {
            CONSTANT [13] { value: false }
          }
          loop_step: {
            IDENT [14] {
              name: @r1
            }
          }
          result: {
            CALL [15] {
              function: _+_
              args: {
                CALL [16] {
                  function: _+_
                  args: {
                    CALL [17] {
                      function: non_pure_custom_func
                      args: {
                        IDENT [18] {
                          name: @r1
                        }
                      }
                    }
                    CALL [19] {
                      function: non_pure_custom_func
                      args: {
                        SELECT [20] {
                          IDENT [21] {
                            name: @r0
                          }.single_int32
                        }
                      }
                    }
                  }
                }
                CALL [22] {
                  function: non_pure_custom_func
                  args: {
                    IDENT [23] {
                      name: @r1
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    CALL [24] {
      function: non_pure_custom_func
      args: {
        SELECT [25] {
          IDENT [26] {
            name: msg
          }.single_int64
        }
      }
    }
  }
}
Test case: CUSTOM_FUNCTION_ELIMINABLE
Source: pure_custom_func(msg.oneof_type.payload.single_int64) + pure_custom_func(msg.oneof_type.payload.single_int32) + pure_custom_func(msg.oneof_type.payload.single_int64) + pure_custom_func(msg.single_int64)
=====>
CALL [1] {
  function: _+_
  args: {
    COMPREHENSION [2] {
      iter_var: #unused
      iter_range: {
        LIST [3] {
          elements: {
          }
        }
      }
      accu_var: @r0
      accu_init: {
        SELECT [4] {
          SELECT [5] {
            IDENT [6] {
              name: msg
            }.oneof_type
          }.payload
        }
      }
      loop_condition: {
        CONSTANT [7] { value: false }
      }
      loop_step: {
        IDENT [8] {
          name: @r0
        }
      }
      result: {
        COMPREHENSION [9] {
          iter_var: #unused
          iter_range: {
            LIST [10] {
              elements: {
              }
            }
          }
          accu_var: @r1
          accu_init: {
            CALL [11] {
              function: pure_custom_func
              args: {
                SELECT [12] {
                  IDENT [13] {
                    name: @r0
                  }.single_int64
                }
              }
            }
          }
          loop_condition: {
            CONSTANT [14] { value: false }
          }
          loop_step: {
            IDENT [15] {
              name: @r1
            }
          }
          result: {
            CALL [16] {
              function: _+_
              args: {
                CALL [17] {
                  function: _+_
                  args: {
                    IDENT [18] {
                      name: @r1
                    }
                    CALL [19] {
                      function: pure_custom_func
                      args: {
                        SELECT [20] {
                          IDENT [21] {
                            name: @r0
                          }.single_int32
                        }
                      }
                    }
                  }
                }
                IDENT [22] {
                  name: @r1
                }
              }
            }
          }
        }
      }
    }
    CALL [23] {
      function: pure_custom_func
      args: {
        SELECT [24] {
          IDENT [25] {
            name: msg
          }.single_int64
        }
      }
    }
  }
}